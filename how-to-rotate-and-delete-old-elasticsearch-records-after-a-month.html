<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>How To Rotate and Delete Old Elasticsearch Records After a Month -</title><meta name=robots content="index,follow,noarchive"><meta name=description content="Quick LinksDeleting Using The &#34;Delete By Query&#34; API  A Better Method: Time Based Indices   Elasticsearch indices can quickly fill up with gigabytes of data, especially if you're logging from multiple servers many times a second. To manage data, Elasticsearch
  Deleting Using The &#34;Delete By Query&#34; API  Elasticsearch offers a &#34;Delete By Query&#34; API, that will remove all documents matching a query. You can use this to match timestamps greater or less than a certain date, albeit a bit crudely:"><meta name=author content="Reinaldo Massengill"><link rel="preload stylesheet" as=style href=https://assets.cdnweb.info/hugo/paper/css/app.css><link rel="preload stylesheet" as=style href=https://assets.cdnweb.info/hugo/paper/css/an-old-hope.min.css><script defer src=https://assets.cdnweb.info/hugo/paper/js/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=./theme.png><link rel=icon href=./favicon.ico><link rel=apple-touch-icon href=./apple-touch-icon.png><meta name=generator content="Hugo 0.98.0"><meta property="og:title" content="How To Rotate and Delete Old Elasticsearch Records After a Month"><meta property="og:description" content="Elasticsearch indices can quickly fill up with gigabytes of data, especially if you're logging from multiple servers many times a second. To manage data, Elasticsearch Elasticsearch offers a &amp;quot;Delete By Query&amp;quot; API, that will remove all documents matching a query. You can use this to match timestamps greater or less than a certain date, albeit"><meta property="og:type" content="article"><meta property="og:url" content="/how-to-rotate-and-delete-old-elasticsearch-records-after-a-month.html"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-09-03T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-03T00:00:00+00:00"><meta itemprop=name content="How To Rotate and Delete Old Elasticsearch Records After a Month"><meta itemprop=description content="Elasticsearch indices can quickly fill up with gigabytes of data, especially if you're logging from multiple servers many times a second. To manage data, Elasticsearch Elasticsearch offers a &amp;quot;Delete By Query&amp;quot; API, that will remove all documents matching a query. You can use this to match timestamps greater or less than a certain date, albeit"><meta itemprop=datePublished content="2024-09-03T00:00:00+00:00"><meta itemprop=dateModified content="2024-09-03T00:00:00+00:00"><meta itemprop=wordCount content="368"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="How To Rotate and Delete Old Elasticsearch Records After a Month"><meta name=twitter:description content="Elasticsearch indices can quickly fill up with gigabytes of data, especially if you're logging from multiple servers many times a second. To manage data, Elasticsearch Elasticsearch offers a &amp;quot;Delete By Query&amp;quot; API, that will remove all documents matching a query. You can use this to match timestamps greater or less than a certain date, albeit"></head><body class=not-ready data-menu=true><header class=header><p class=logo><a class=site-name href=./index.html>ZenVlog</a><a class=btn-dark></a></p><script>let bodyClx=document.body.classList,btnDark=document.querySelector(".btn-dark"),sysDark=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark"),setDark=e=>{bodyClx[e?"add":"remove"]("dark"),localStorage.setItem("dark",e?"yes":"no")};setDark(darkVal?darkVal==="yes":sysDark.matches),requestAnimationFrame(()=>bodyClx.remove("not-ready")),btnDark.addEventListener("click",()=>setDark(!bodyClx.contains("dark"))),sysDark.addEventListener("change",e=>setDark(e.matches))</script><nav class=menu><a href=./sitemap.xml>Sitemap</a></nav></header><main class=main><article class=post-single><header class=post-title><p><time>Sep 3, 2024</time>
<span>Reinaldo Massengill</span></p><h1>How To Rotate and Delete Old Elasticsearch Records After a Month</h1></header><section class=post-content><h3>Quick Links</h3><ul class=table-content-level-1><li><a href=#>Deleting Using The "Delete By Query" API</a></li></ul><ul class=table-content-level-1><li><a href=#>A Better Method: Time Based Indices</a></li></ul><p>Elasticsearch indices can quickly fill up with gigabytes of data, especially if you're logging from multiple servers many times a second. To manage data, Elasticsearch</p><strong class="an-zone-tag-top ad-zone-advertising-tag"></strong> <strong class="an-zone-tag-bottom ad-zone-advertising-sub-tag"></strong><h2 id=deleting-using-the-delete-by-query-api>Deleting Using The "Delete By Query" API</h2><p>Elasticsearch offers a "Delete By Query" API, that will remove all documents matching a query. You can use this to match timestamps greater or less than a certain date, albeit a bit crudely:</p><pre>POST indexname/_delete_by_query  <p>{</p>  <p> "query": {</p>  <p> "range" : {</p>  <p> "@timestamp" : {</p>  <p> "gte" : "09/02/2020",</p>  <p> "lte" : "11/02/2020",</p>  <p> "format": "dd/MM/yyyy||yyyy"</p>  <p> }</p>  <p> }</p>  <p> }</p>  <p>}</p></pre><p>However, this query is&nbsp;<strong>really slow</strong>. It scales linearly with document size. If you have enough documents that you need to be rotating them to prevent your Elasticsearch instance from bursting into flames, you probably can't delete records this way, and will need to use time-based indices instead.</p><h2 id=a-better-method-time-based-indices>A Better Method: Time Based Indices</h2><p>In Elasticsearch, you don't usually use indexes directly. Your dashboards use index patterns, which can match multiple indexes at once. The reason for this is that the indexes themselves can act as groups of data, such as grouping by day or month.</p><strong class="an-zone-tag-top ad-zone-advertising-tag"></strong> <strong class="an-zone-tag-bottom ad-zone-advertising-sub-tag"></strong><p>It's much easier to manage and rotate entire indices, so if you had each ingester configured to add the current date to the index name,</p><pre>index: "indexname-%{+yyyy.MM.dd}"</pre><p>Of course, this requires you to configure the ingest pipeline to write to the daily index. You'll need to set up your loggers to ingest data in this format.</p><p>Once that's done though, you can create a new Index Lifecycle Policy to handle the automatic rollover of data. This option is available under "Stack Management" in the Kibana dashboard.</p><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/static1.howtogeekimages.com/wordpress/wp-content/uploads/csit/2020/12/00a665be.png><p>You can configure multiple phases of index rollover, but for this purpose it's easier to just disable rollover and enable the delete phase, configuring it to remove indices older than X number of days.</p><strong class="an-zone-tag-top ad-zone-advertising-tag"></strong> <strong class="an-zone-tag-bottom ad-zone-advertising-sub-tag"></strong> <img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/static1.howtogeekimages.com/wordpress/wp-content/uploads/csit/2020/12/745371ea.png><p>Then, to actually apply it to an index template, you'll need to select "Add Policy To Index Template" under "Actions" in the lifecycle policy list.</p><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/static1.howtogeekimages.com/wordpress/wp-content/uploads/csit/2020/12/fc6f61ff.png><p>Select the index pattern you wish to add, and the policy should take effect immediately, and your old indices in the pattern will be deleted.</p><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmivp6x7qbvWraagnZWge6S7zGibnq6fpcBwtM6wZK2nXae8ta3TnmSappRisaa4xK2cZqecmXqmuMCsq6Kbo5qus6%2FHZqmem5%2BnsbR5wJ%2Brnqpdlnquu82tn2g%3D</p></section><nav class=post-nav><a class=prev href=./greg-jennings.html><span>←</span><span>Greg Jennings</span></a>
<a class=next href=./huntington-beach-jane-doe-identified-andrea-kuiper-html.html><span>Huntington Beach 'Jane Doe' identified as Andrea Kuiper</span><span>→</span></a></nav></article></main><footer class=footer><p>&copy; 2024 <a href=./></a></p><p>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</p></footer><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>